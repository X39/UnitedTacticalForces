@using System.ComponentModel.DataAnnotations
@using System.Diagnostics.Contracts
@using X39.UnitedTacticalForces.WebApp.Services
@using X39.UnitedTacticalForces.WebApp.Services.UserRepository
@inject IUserRepository UserRepository
@inject MeService MeService
@inject IStringLocalizer<Language> Localizer
@if (MeService.IsAuthenticated && User.PrimaryKey != MeService.User.PrimaryKey && MeService.IsInRolesOrAdmin(Roles.UserVerify))
{
    <MudTooltip>
        <TooltipContent>
            <MudText>@Localizer[nameof(Language.Pages_Users_ToggleVerified_ToolTip)]</MudText>
        </TooltipContent>
        <ChildContent>
            <MudSwitch
                ThumbIcon="@((User.Verified ?? false) ? Icons.Material.Filled.DoDisturb : Icons.Material.Filled.CheckCircleOutline)"
                Color="Color.Success"
                Checked="@(User.Verified ?? false)"
                CheckedChanged="ToggleUserVerifiedAsync"/>
        </ChildContent>
    </MudTooltip>
}

@code {

    [Parameter, EditorRequired, Required]
    public User User { get; set; } = null!;

    private async Task ToggleUserVerifiedAsync()
    {
        Contract.Assert(User.PrimaryKey is not null);
        await UserRepository.ToggleVerifiedUserAsync(User.PrimaryKey.Value)
            .ConfigureAwait(false);
        User.IsBanned = !User.IsBanned;
    }

}